<!DOCTYPE html>
<html>

<head>
    <title>HVAC Builder</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <link rel="stylesheet" type='text/css' href="/stylesheets/style.css">
</head>

<body>

    <nav id='navTop' class="navbar navbar-expand-sm justify-content-end">
        <ul class="navbar-nav">
            <img src="/public/images/CCG_Logo_New.bmp" class="rounded-circle" alt="CCG LOGO">
            <li class="nav-item"></li>
            <a class="nav-link" id='home' href="/">Get Started</a>
            </li>
            <li class="nav-item">
                </liclass>
                <a class='nav-link' id='options' href="/options">Projects</a>
            </li>
            <li class="nav-item"></li>

            <a class="nav-link" id='points' href='/points'>Contact</a>
            </li>
            <li class="nav-item"></li>
            <a class="nav-link" id='sequenceLink' href='/sequence'>Login</a></li>
            </li>
        </ul>
    </nav>
    <div class='row'>
        <div id='sideBar' class='container col-sm-3'>

            <ul class="nav flex-column">
                <li>Projects</li>
            </ul>


        </div>

        <div id='navBottom' class='container col-sm-9'>
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href='/'>Overview</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href='/options'> Options</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href='/points'>Points</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link active" href='/sequence'>Sequence</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href='/drawings'>Drawings</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href='/material'>Material</a>
                </li>


            </ul>
        </div>


    </div>
    <div class="container col-sm-9">
        <h1>Sequence</h1>
        <div id='selectAHUDiv'>
            <form id='selectAHUForm'>
                <label>Select an AHU unit in the Project</label>
                <select id='selectAHU'>
                    <option>select...</option>
                </select>
                <button id='ahuButton' type='button'>Select Unit Options</button>
            </form>
            <br><br>
        </div>
        <div class="container" id='sequence'>
        </div>
    </div>
</body>
<script>

    $(document).ready(function () {
        var project = JSON.parse(localStorage.getItem('project'));
        var url = document.URL;
        var n = url.lastIndexOf('/');
        var ahuName = url.substring((n + 1), url.length);
        if (project != undefined) {
            var x;
            for (x in project.units) {
                if (project.units[x] != null) {
                    var option = document.createElement('option');
                    var parentNode = document.getElementById('selectAHU');
                    parentNode.appendChild(option);
                    option.textContent = project.units[x].name;
                }
            }
            if (ahuName != 'points') {
                console.log('inside if');
                var temp = document.getElementById('selectAHU').options;
                console.log(temp);
                var flag;
                if (temp.length > 0) {
                    for (x = 0; x < temp.length; x++) {
                        console.log(x);
                        console.log(temp[x].value);
                        if (temp[x].value == ahuName) {
                            console.log(temp[x].value);
                            flag = x - 1;
                        }
                    }
                }
                if (flag != undefined) {
                    displaySequence(flag);
                }

            }
        }
    });


    document.getElementById('selectAHU').onchange = function () {
        removeNodes();
        displaySequence(this.selectedIndex - 1);
        //removeNodes();
    }
    function removeNodes() {
        console.log("called removeNodes");
        var topNode = document.getElementById('sequence');
        var children = topNode.childNodes;
        console.log(topNode);
        console.log(children);
        var x = children.length;
        console.log(topNode.hasChildNodes())
        console.log(x);
        while (x > 1) {
            topNode.lastChild.remove();
            x = x - 1;
        }
        children.remove;


    }
    function displaySequence(abc) {
        var project = JSON.parse(localStorage.getItem('project'));
        var ahu = project.units[abc];
        console.log(ahu);
        if (ahu == undefined) {
            console.log("No Air Handler Built!!");
        } else {
            var topNode = document.getElementById('sequence');
            var ele;
            var points = ahu.points
            for (ele in points) {
                var val = points[ele];
                //console.log(val);
                var ele2;
                for (ele2 in val) {
                    var point = val[ele2];
                    if ((point.isUsed == true) && (point.sequence != undefined)) {
                        var temp = point.sequence;

                        var node = document.createElement('div');
                        node.id = JSON.stringify(ele);
                        node.class = 'w3-container';
                        topNode.appendChild(node);
                        var textNode = document.createElement('div');
                        textNode.innerHTML = temp;
                        node.appendChild(textNode);
                        //console.log(JSON.stringify(ele));
                        //console.log(temp);
                    }
                }
            }
        }
    }

</script>

</html>