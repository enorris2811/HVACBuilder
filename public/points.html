<!DOCTYPE html>
<html>

<head>
    <title>HVAC Builder</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <link rel="stylesheet" type='text/css' href="/stylesheets/style.css">
</head>

<body>

    <nav id='navTop' class="navbar navbar-expand-sm justify-content-end">
        <ul class="navbar-nav">
            <img src="/public/images/CCG_Logo_New.bmp" class="rounded-circle" alt="CCG LOGO">
            <li class="nav-item"></li>
            <a class="nav-link" id='home' href="/">Get Started</a>
            </li>
            <li class="nav-item">
                </liclass>
                <a class='nav-link' id='options' href="/options">Projects</a>
            </li>
            <li class="nav-item"></li>

            <a class="nav-link" id='points' href='/points'>Contact</a>
            </li>
            <li class="nav-item"></li>
            <a class="nav-link" id='sequence' href='/sequence'>login</a></li>
            </li>
        </ul>
    </nav>
    <div class='row'>
        <div id='sideBar' class='container col-sm-3'>

            <ul class="nav flex-column">
                <li>Projects</li>
            </ul>


        </div>

        <div id='navBottom' class='container col-sm-9'>
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href='/'>Overview</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href='/options'> Options</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link active" href='/points'>Points</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href='/sequence'>Sequence</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href='/drawings'>Drawings</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href='/material'>Material</a>
                </li>


            </ul>
        </div>


    </div>
   
    <div class="container col-sm-9">
        <h1>Points List</h1>
        <div class="container" id='selectAHUDiv'>
            <form id='selectAHUForm'>
                <label>Select an AHU unit in the Project</label>
                <select id='selectAHU'>
                    <option>select...</option>
                </select>

            </form>
            <br><br>
        </div>
        <div class="container">
            <table id='ahuTable' class='table'>
                <div class='tableHeader'>
                    <tr id='tableHeader' class='rowHeader'>
                        <th>
                            Point Name
                        </th>
                        <th>
                            Analog Input
                        </th>
                        <th>
                            Analog Output
                        </th>
                        <th>
                            Binary Input
                        </th>
                        <th>
                            Binary Output
                        </th>
                        <th>
                            Analog Value
                        </th>
                        <th>
                            Binary Value
                        </th>
                        <th>
                            Loop
                        </th>
                        <th>
                            Schedule
                        </th>
                        <th>
                            Trend
                        </th>
                        <th>
                            Alarm
                        </th>
                        <th>
                            Show on Graphic
                        </th>
                    </tr>
                </div>

            </table>
        </div>
    </div>
</body>

<script>

    $(document).ready(function () {
        var project = JSON.parse(localStorage.getItem('project'));
        var url = document.URL;
        var n = url.lastIndexOf('/');
        var ahuName = url.substring((n + 1), url.length);
        console.log(ahuName);

        if (project != undefined) {
            var x;
            for (x in project.units) {
                if (project.units[x] != null) {
                    var option = document.createElement('option');
                    var parentNode = document.getElementById('selectAHU');
                    parentNode.appendChild(option);
                    option.textContent = project.units[x].name;
                    option.value = project.units[x].name;
                }
            }
            if (ahuName != 'points') {
                console.log('inside if');
                var temp = document.getElementById('selectAHU').options;
                console.log(temp);
                if (temp.length > 0) {
                    for (x = 0; x < temp.length; x++) {
                        console.log(x);
                        console.log(temp[x].value);
                        if (temp[x].value == ahuName) {
                            console.log(temp[x].value);
                            populateTable(x - 1);
                        }
                    }
                }
            }

        }
    })
    document.getElementById('selectAHU').onchange = function () {
        removeNodes();
        populateTable(this.selectedIndex - 1);
        //removeNodes();
    }
    function removeNodes() {
        var nodeTop = document.getElementById('ahuTable');
        console.log(nodeTop);
        console.log(nodeTop.hasChildNodes());
        var x = nodeTop.childElementCount;
        while (x > 1) {
            console.log(bottomNode);
            var bottomNode = nodeTop.lastChild;
            bottomNode.remove();
            console.log('hello hello hello');
            x = nodeTop.childElementCount;
        }
        console.log('all nodes removed');
    }

    function populateTable(a) {
        $.get('/pointsModel', function (data, status) {
            var project = JSON.parse(localStorage.getItem('project'));
            var points = data.points;
            var ahu = project.units[a].points;
            var hardPoint = points.hardware;
            var softPoint = points.software;
            var AI = 0, AO = 0, BI = 0, BO = 0, AV = 0, BV = 0, Loop = 0, Schedule = 0, Trend = 0, Alarm = 0, Graphics = 0;
            var totals = { AI, AO, BI, BO, AV, BV, Loop, Schedule, Trend, Alarm, Graphics };
            // console.log(JSON.stringify(hardPoint));
            //console.log(JSON.stringify(softPoint));
            //localStorage.clear();
            if (ahu == undefined) {
                console.log("No Air Handler Built!!");
            } else {
                //console.log(JSON.stringify(ahu));
                //console.log(ahu);


                var ele;
                var b = 0;
                for (ele in ahu) {


                    // console.log(ahu.hasOwnProperty(ele));
                    //console.log(JSON.stringify(ele));
                    var val = ahu[ele];
                    //console.log(val);



                    var pointName = JSON.stringify(ele);
                    var i;
                    for (i in val) {
                        //console.log(JSON.stringify(i));
                        var x = val[i];
                        if (i != 'none') {
                            //console.log(JSON.stringify(x));
                            if (x.isUsed == true) {
                                // console.log('RIGHT HERE!!!');
                                var q = x.points;
                                var z;

                                for (z in q) {
                                    console.log(totals);

                                    b++;
                                    var tableTop = document.getElementById('ahuTable');
                                    var tableRow = document.createElement("tr");
                                    tableRow.class = 'tableRow';
                                    //console.log(tableRow.id);
                                    tableTop.appendChild(tableRow);
                                    var pointName = q[z];
                                    var temp;
                                    for (temp in hardPoint) {
                                        var wx = hardPoint[temp];
                                        var wy = temp;
                                        //console.log(wx);
                                        if (pointName == wy) {
                                            //console.log("ANd AGAIN RIGHT HERE!!!");
                                            if (wx.isUsed == false) {
                                                wx.isUsed == true;
                                                for (a = 0; a < 12; a++) {
                                                    var tableColumn = document.createElement('td');
                                                    tableColumn.class = "tableCell";
                                                    var textNode = document.createTextNode('0');
                                                    tableColumn.appendChild(textNode);
                                                    tableRow.appendChild(tableColumn);
                                                    // console.log(a);
                                                    switch (a) {
                                                        case (0):

                                                            console.log(preparePointName(JSON.stringify(pointName)));
                                                            textNode.textContent = preparePointName(JSON.stringify(pointName));

                                                            break;
                                                        case (1):
                                                            console.log(wx);
                                                            textNode.textContent = wx.points.AI;
                                                            if (wx.points.AI == 1) {
                                                                totals.AI = totals.AI + 1;

                                                            }

                                                            break;
                                                        case (2):
                                                            textNode.textContent = wx.points.AO;
                                                            if (wx.points.AO == 1) {
                                                                totals.AO++;
                                                            }

                                                            break;
                                                        case (3):
                                                            textNode.textContent = wx.points.BI;
                                                            if (wx.points.BI == 1) {
                                                                totals.BI++;

                                                            }
                                                            break;
                                                        case (4):
                                                            textNode.textContent = wx.points.BO;
                                                            if (wx.points.BO == 1) {
                                                                totals.BO++;
                                                            }

                                                            break;
                                                        case (5):
                                                            textNode.textContent = wx.points.AV;
                                                            if (wx.points.AV == 1) {
                                                                totals.AV++;
                                                            }

                                                            break;
                                                        case (6):
                                                            textNode.textContent = wx.points.BV;
                                                            if (wx.points.BV == 1) {
                                                                totals.BV++;
                                                            }


                                                            break;
                                                        case (7):
                                                            textNode.textContent = wx.points.Loop;
                                                            if (wx.points.Loop == 1) {
                                                                totals.Loop++
                                                            }

                                                            break;
                                                        case (8):
                                                            textNode.textContent = wx.points.Schedule;
                                                            if (wx.points.Schedule == 1) {
                                                                totals.Schedule++;
                                                            }

                                                            break;
                                                        case (9):
                                                            textNode.textContent = wx.points.Trend;
                                                            if (wx.points.Trend == 1) {
                                                                totals.Trend++;
                                                            }

                                                            break;
                                                        case (10):
                                                            textNode.textContent = wx.points.Alarm;
                                                            if (wx.points.Alarm == 1) {

                                                                totals.Alarm++;
                                                            }
                                                            break;
                                                        case (11):
                                                            textNode.textContent = wx.points.Graphics;
                                                            if (wx.points.Graphics == 1) {
                                                                totals.Graphics++;
                                                            }

                                                            break;
                                                    }


                                                }
                                            }
                                        }

                                    }

                                    var temp2;
                                    for (temp2 in softPoint) {
                                        var wx = softPoint[temp2];
                                        var wy = temp2;
                                        //console.log(wx);
                                        if (pointName == wy) {
                                            // console.log("ANd AGAIN RIGHT HERE!!!");
                                            if (wx.isUsed == false) {
                                                wx.isUsed == true;
                                                for (a = 0; a < 12; a++) {
                                                    var tableColumn = document.createElement('td');
                                                    tableColumn.class = "tableCell";
                                                    var textNode = document.createTextNode("0");
                                                    tableColumn.appendChild(textNode);
                                                    tableRow.appendChild(tableColumn);
                                                    switch (a) {
                                                        case (0):
                                                            console.log(preparePointName(JSON.stringify(pointName)));
                                                            textNode.textContent = preparePointName(JSON.stringify(pointName));

                                                            break;
                                                        case (1):
                                                            console.log(wx);
                                                            textNode.textContent = wx.points.AI;
                                                            if (wx.points.AI == 1) {
                                                                totals.AI = totals.AI + 1;

                                                            }

                                                            break;
                                                        case (2):
                                                            textNode.textContent = wx.points.AO;
                                                            if (wx.points.AO == 1) {
                                                                totals.AO++;
                                                            }

                                                            break;
                                                        case (3):
                                                            textNode.textContent = wx.points.BI;
                                                            if (wx.points.BI == 1) {
                                                                totals.BI++;

                                                            }
                                                            break;
                                                        case (4):
                                                            textNode.textContent = wx.points.BO;
                                                            if (wx.points.BO == 1) {
                                                                totals.BO++;
                                                            }

                                                            break;
                                                        case (5):
                                                            textNode.textContent = wx.points.AV;
                                                            if (wx.points.AV == 1) {
                                                                totals.AV++;
                                                            }

                                                            break;
                                                        case (6):
                                                            textNode.textContent = wx.points.BV;
                                                            if (wx.points.BV == 1) {
                                                                totals.BV++;
                                                            }


                                                            break;
                                                        case (7):
                                                            textNode.textContent = wx.points.Loop;
                                                            if (wx.points.Loop == 1) {
                                                                totals.Loop++
                                                            }

                                                            break;
                                                        case (8):
                                                            textNode.textContent = wx.points.Schedule;
                                                            if (wx.points.Schedule == 1) {
                                                                totals.Schedule++;
                                                            }

                                                            break;
                                                        case (9):
                                                            textNode.textContent = wx.points.Trend;
                                                            if (wx.points.Trend == 1) {
                                                                totals.Trend++;
                                                            }

                                                            break;
                                                        case (10):
                                                            textNode.textContent = wx.points.Alarm;
                                                            if (wx.points.Alarm == 1) {

                                                                totals.Alarm++;
                                                            }
                                                            break;
                                                        case (11):
                                                            textNode.textContent = wx.points.Graphics;
                                                            if (wx.points.Graphics == 1) {
                                                                totals.Graphics++;
                                                            }

                                                            break;
                                                    }


                                                }
                                            }
                                        }

                                    }



                                }

                            }
                        }

                    }



                }
                //totals row
                var tableTop = document.getElementById('ahuTable');
                var tableRow = document.createElement("tr");
                tableRow.class = 'tableTotals';

                tableTop.appendChild(tableRow);
                var temp = document.createElement('td');

                tableRow.appendChild(temp);
                temp.innerText = "totals:"
                for (x in totals) {
                    var tempNode = document.createElement('td');
                    tableRow.appendChild(tempNode);
                    console.log();
                    tempNode.innerText = totals[x];
                }

            }
        });
    }

    function preparePointName(s) {
        var i = s.indexOf('"');
        var n = s.lastIndexOf(s.length, '"');
        console.log(i);
        console.log(n);
        var temp = s.substring((i + 1), s.length);
        console.log(temp);
        s = temp.substring(0, temp.length - 1);
        s = addSpaces(s)
        return s;
    }

    function addSpaces(s) {

        var n = s.length;
        var temp = [];
        for (x in s) {
            console.log(s[x].charCodeAt(0));
            var i = s[x].charCodeAt(0);
            if ((i <= 90) && (i >= 65)) {
                temp.push(x);
            }
        }
        console.log(temp);
        var newS = "";
        var last = 0;
        for (z in temp) {
            var cap = temp[z];
            newS += s.substring(last, cap) + " ";
            console.log(newS);
            last = cap;
        }
        newS += s.substring(last, s.length);
        console.log(newS);
        return newS;
    }
</script>

</html>